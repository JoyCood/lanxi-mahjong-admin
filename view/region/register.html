{% set TITLE="注册" %}
{% extends "_base.html" %}
{% block head %}
{% endblock %}

{% block body %}
<div class="app nofooter">
    <header class="app-header">
        <a class="app-back" app-action="back"></a>
        <h1>区域注册</h1>
        <nav>
            <a href="region/login">登录</a>
        </nav>
    </header>
    <main class="app-main">
        <div>
            <form id="register-form" class="w">
                <div class="form-row">
                    <label class="form-label">昵称:*</label>
                    <input class="form-control" type="text" name="Nickname" placeholder="请输入昵称" autocomplete="off" app-required="on" />
                </div>
                <div class="form-row">
                    <label class="form-label">游戏ID:*</label>
                    <input class="form-control" type="text" name="Gameid" placeholder="请输入游戏ID" autocomplete="off" app-required="on" />
                </div>
                <div class="form-row">
                    <label class="form-label">微信号:*</label>
                    <input class="form-control" type="text" name="Wechat" name="Nickname" placeholder="微信号" autocomplete="off" app-required="on" />
                </div>
                <div class="form-row">
                    <label class="form-label">手机号:*</label>
                    <input id="register-phone" class="form-control" type="tel" name="Phone" placeholder="请输入手机号" autocomplete="off" app-required="on" />
                </div>
                <div class="form-row">
                    <label class="form-label">验证码:*</label>
                    <input class="form-control" type="tel" name="Captcha" placeholder="请输入验证码" autocomplete="off" app-required="on" />
                    <button id="register-captcha-btn" type="button" class="btn btn-info">获取验证码</button>
                </div>
                <div class="form-row">
                    <label class="form-label">密码:*</label>
                    <input id="register-password"  class="form-control" type="password" name="Password" placeholder="请输入密码" app-required="on" />
                </div>
                <div class="form-row">
                    <label class="form-label">确认密码:*</label>
                    <input id="register-confirm" class="form-control" type="password" name="Confirm" placeholder="请再次输入密码" app-required="on" />
                </div>
                <div class="form-row">
                    <input id="register-agree" type="checkbox" name="Agree" />
                    <label for="register-agree">同意《<a href="javascript:;">合作协议</a>》</label>
                </div>
                <div class="form-action">
                    <button type="submit" class="btn btn-success form-control">注册</button>
                </div>
            </form>
        </div>
    </main>
    <footer class="app-footer">
    </footer>
</div>
{% endblock %}

{% block js %}
<script>
$(document).ready(function() {
    $('#register-captcha-btn').on('click', function() {
        var btn = $(this);
        var txt = btn.text();
        var sec = 0;
        var num = $.trim($('#register-phone').val());
        if(num == '') {
            App.alert('请输入有效的手机号码');
            return false;
        }
        btn.prop('disabled', 'true').addClass('btn-disabled');
        App.ajax({
            url: 'region/code',
            type: 'post',
            data: {'phone': num},
            dataType: 'json',
            success: function() {
                btn.data('interval') || btn.data('interval', setInterval(function() {
                    btn.text('验证码(' + ++sec + 's)');
                    if(sec == 30) {
                        clearInterval(btn.data('interval'));
                        btn.removeData('interval');
                        btn.prop('disabled', false).removeClass('btn-disabled').text(txt);
                    }
                }, 1000));
            },
            error: function() {
                btn.prop('disabled', false).removeClass('btn-disabled').text(txt);
            }
        });
    });
    $('#register-form').on('submit', function() {
        App.submitForm(this, {
            checkValidity: function() {
                var rs = false;
                if($('#register-password').val() != $('#register-confirm').val()) {
                    App.alert('两次输入的密码不一致，请重新输入');
                } else if(!$('#register-agree').prop('checked')) {
                    App.alert('请同意《合作协议》才能完成注册');
                } else {
                    rs = true;
                }
                return rs;
            }
        });
        return false;
    });
});
</script>
{% endblock %}